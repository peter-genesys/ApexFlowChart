var flow=function(){"use strict";var v={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(e){v.isAPEX()&&apex.debug.info(e)},error:function(e){(v.isAPEX()?apex.debug:console).error(e)}},groupObjectArray:function(e,n){return e&&Array.isArray(e)?e.reduce(function(e,t){return t[n]&&(e[t[n]]=e[t[n]]||[]).push(t),s,e},{}):[]},link:function(e){return window.location=e},escapeHTML:function(e){if(null===e)return null;if(void 0!==e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}return v.isAPEX()?apex.util.escapeHTML(String(e)):(e=String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},loader:{start:function(e){var t,n;v.isAPEX()?apex.util.showSpinner($(e)):((t=$("<span></span>")).attr("id","loader"+e),t.addClass("ct-loader"),(n=$("<i></i>")).addClass("fa fa-refresh fa-2x fa-anim-spin"),n.css("background","rgba(121,121,121,0.6)"),n.css("border-radius","100%"),n.css("padding","15px"),n.css("color","white"),t.append(n),$(e).append(t))},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},jsonSaveExtend:function(t,n){var r={};if("string"==typeof n)try{n=JSON.parse(n)}catch(e){v.debug.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),v.debug.error(e),v.debug.error(n)}else r=n;try{r=$.extend(!0,t,n)}catch(e){v.debug.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),v.debug.error(e),r=t,v.debug.error(r)}return r},noDataMessage:{show:function(e,t){var n=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),r=$("<div></div>"),i=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");r.append(i);t=$("<span></span>").text(t).css("display","block").css("color","#707070").css("font-size","12px");n.append(r).append(t),$(e).append(n)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},cutString:function(t,e){try{return!(e<0)&&t.length>e?t.substring(0,e-3)+"...":t}catch(e){return t}}};return{initialize:function(e,t,n,r,i,a){var s,o,f=null,l=v.jsonSaveExtend({refresh:0,refreshIcon:!0,style:[{name:"default",vertexstyle:{shape:"rectangle",perimeter:"rectanglePerimeter",strokeColor:"gray",rounded:!0,fillColor:"#EEEEEE",align:"center",verticalAlign:"middle",fontSize:"12",fontStyle:1,fontColor:"black"},edgestyle:{strokeColor:"#0C0C0C",fontColor:"black",labelBackgroundColor:"white",rounded:!0,fontSize:"10"}}]},n),d="#"+e,c=$(d),u=(s=c,(o=$("<div></div>")).attr("id",d+"-c"),o.css("min-height","100px"),s.append(o),o[0]),p=[];if(!mxClient.isBrowserSupported())return mxUtils.error("Browser is not supported!",200,!1);function g(e){p.parent=f.getDefaultParent(),f.removeCells(f.getChildVertices(f.getDefaultParent())),f.getModel().beginUpdate();try{$.each(e,function(e,t){0==t.PARENT.length&&(t.PARENT="parent");var n,r,i,a,s,o,l,d,c,u,g=mxUtils.createXmlDocument().createElement("UserObject");switch(g.setAttribute("label",t.VALUE),t.TYPE.toLowerCase()){case"vertex":n=t.ID,r=t.PARENT,i=g,a=t.X,s=t.Y,o=t.WIDTH,l=t.HEIGHT,d=t.STYLE,c=t.CONNECTABLE,u=t.RELATIVE,v.debug.info("setVertex(vertexId "+n+", parentVertexId "+r+", value "+i+", x "+a+",  y "+s+", width "+o+", height "+l+", style "+d+", connectable "+c+", relative "+u+")"),p[n]=f.insertVertex(p[r],n,i,a,s,o,l,d,u),p[n].setConnectable(c);break;case"edge":o=t.ID,l=t.PARENT,d=g,u=t.SOURCE,n=t.TARGET,c=t.STYLE,v.debug.info("setEdge(edgeId "+o+", parentVertexId "+l+", value "+d+", sourceVertexId "+u+", targetVertexId "+n+", style "+c+")"),f.insertEdge(p[l],o,d,p[u],p[n],c);break;default:alert("Invalid type only edge and vertex is supported")}})}finally{f.getModel().endUpdate(),h()}}function h(){$(d).is(":visible")&&(f.fit(null,!1,0,!0,!1,!1,.8*$(window).height()),f.view.rendering=!0,f.refresh())}mxEvent.disableContextMenu(u),f=new mxGraph(u),function(){var r=f.getStylesheet().getDefaultVertexStyle(),e=jsonPath(l,'$.style[?(@.name=="default")]')[0];!function(n){$.each(e.vertexstyle,function(e,t){n[e]=t}),v.debug.info("setDefaultStyle: default"),v.debug.info(n),f.getStylesheet().putDefaultVertexStyle(n)}(r);var t=jsonPath(l,'$.style[?(@.name !="default" && @.vertexstyle)]');$.each(t,function(e,t){var n;n=r,t=t,n=mxUtils.clone(n),$.each(t.vertexstyle,function(e,t){n[e]=t}),f.getStylesheet().putCellStyle(t.name,n),v.debug.info("setStyle: "+t.name),v.debug.info(n)}),r=f.getStylesheet().getDefaultEdgeStyle(),$.each(e.edgestyle,function(e,t){r[e]=t}),r[mxConstants.STYLE_EDGE]=mxEdgeStyle.ElbowConnector,f.getStylesheet().putDefaultEdgeStyle(r),t=jsonPath(l,'$.style[?(@.name !="default" && @.edgestyle)]'),$.each(t,function(e,t){var n;n=r,t=t,n=mxUtils.clone(n),$.each(t.edgestyle,function(e,t){n[e]=t}),f.getStylesheet().putCellStyle(t.name,n),v.debug.info("setEdgeStyle: "+t.name),v.debug.info(n)})}(),f.setConnectable(!0),f.setAllowDanglingEdges(!1),f.setEnabled(!1),f.addListener(mxEvent.CLICK,function(e,t){t=t.getProperty("cell");null!=t&&(1==t.vertex&&(v.debug.info("VertexClicked: "+t.id),v.isAPEX()?apex.event.trigger(u,"VertexClicked",t.id):$.event.trigger({type:"VertexClicked",message:t.id})),1==t.edge&&(v.debug.info("EdgeClicked: "+t.id),v.isAPEX()?apex.event.trigger(u,"EdgeClicked",t.id):$.event.trigger({type:"EdgeClicked",message:t.id})))}),f.setHtmlLabels(!0),f.convertValueToString=function(e){if(null!=e.div)return e.div;if(mxUtils.isNode(e.value)&&"userobject"==e.value.nodeName.toLowerCase()){var t=document.createElement("div"),e=e.getAttribute("label");return null==e&&(e=""),t.innerHTML=e,t}return""},new mxRubberband(f),x(),h();try{$("#"+i).bind("apexrefresh",function(){console.log(i),$("#"+i).is(":visible")&&x()})}catch(e){v.debug.error("Can't bind refresh event on "+d+". Apex is missing"),v.debug.error(e)}function x(){v.isAPEX()?(l.refreshIcon&&v.loader.start(d),apex.server.plugin(t,{pageItems:r},{success:function(e){g(e.row),l.refreshIcon&&v.loader.stop(d)},error:function(e){$(d).empty(),v.noDataMessage.show(d,"Loading Data Error!"),l.refreshIcon&&v.loader.stop(d),v.debug.error(e.responseText)},dataType:"json"})):a?g(a):v.debug.error("No offline Data found or apex and ajax id is unedefined.")}0<l.refresh&&setInterval(function(){$(d).is(":visible")&&x()},1e3*l.refresh),v.isAPEX()?($(window).on("apexwindowresized",function(){h()}),$("#t_TreeNav").on("theme42layoutchanged",function(){h()}),setInterval(function(){!c.is(":visible")||c.width()==c.find("svg").width()&&c.height()==c.find("svg").height()||h()},350)):$(window).resize(function(){h()})}}}();